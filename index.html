<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>바닐라js로 메타버스 구현 2차</title>
  <style>
    body {
      margin: 0;
      height: 100vh;
      display: flex;
      justify-content: center;
      place-items: center;
    }

    canvas {
      background-color: skyblue;
    }
  </style>
</head>

<body>
  <canvas width="800" height="600" id="gamePanel"></canvas>


  <script>
    const canvas = document.getElementById('gamePanel');
    const context = canvas.getContext('2d');

    let windyWidth;
    let windyHeight;
    let windyX;
    let windyY;
    let windyCenterX;
    let windyCenterY;
    let windySpeed = 0.5;

    function makePlayerImage(imagePath) {
      let imageObject = new Image();
      imageObject.src = imagePath;

      imageObject.onload = function () {
        windyWidth = imageObject.width * 1.3;
        windyHeight = imageObject.height * 1.3;

        windyX = (canvas.width / 2) - (windyWidth / 2);
        windyY = (canvas.height / 2) - (windyHeight / 2);

        windyCenterX = windyX + (windyWidth / 2);
        windyCenterY = windyY + (windyHeight / 2);

        drawWindy();
        requestAnimationFrame(windyMove);
      }

      return imageObject;
    }

    let windyLeftWalk = makePlayerImage('assets/windy/walkingLeft.png');
    let windyLeftWatch = makePlayerImage('assets/windy/watchingLeft.png');
    let windyRightWalk = makePlayerImage('assets/windy/walkingRight.png');
    let windyRightWatch = makePlayerImage('assets/windy/watchingRight.png');
    let windyDownLeft = makePlayerImage('assets/windy/walkingDownLeftFoot.png');
    let windyDownRight = makePlayerImage('assets/windy/walkingDownRightFoot.png');
    let windyUpLeft = makePlayerImage('assets/windy/walkingUpLeftFoot.png');
    let windyUpRight = makePlayerImage('assets/windy/walkingUpRightFoot.png');


    let keyState = {
      ArrowUp: false,
      ArrowDown: false,
      ArrowRight: false,
      ArrowLeft: false
    };

    window.addEventListener('keydown', (e) => {
      if (e.key in keyState) {
        keyState[e.key] = true;
      }

      if (keyState.ArrowUp == true) {
        context.clearRect(windyX, windyY, windyWidth, windyHeight);
        context.drawImage(windyUpLeft, windyX, windyY);
      }
    });

    window.addEventListener('keyup', (e) => {
      if (e.key in keyState) {
        keyState[e.key] = false;
      }
    });


    function drawWindy() {
      context.clearRect(0, 0, canvas.width, canvas.height);
      context.drawImage(windyDownLeft, windyX, windyY, windyWidth, windyHeight);
    }

    function windyMove() {
      if (keyState.ArrowUp) {
        windyY -= windySpeed;
        windyCenterY -= windySpeed;
      }

      if (keyState.ArrowDown) {
        windyY += windySpeed;
        windyCenterY += windySpeed;
      }

      if (keyState.ArrowLeft) {
        windyX -= windySpeed;
        windyCenterX -= windySpeed;
      }
      if (keyState.ArrowRight) {
        windyX += windySpeed;
        windyCenterX += windySpeed;
      }

      drawWindy();
      requestAnimationFrame(windyMove);
    }

  </script>
</body>

</html>